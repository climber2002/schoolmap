//Set the map size
function setMapSize() {
  var totalWidth = $(window).width();
  var totalHeight = $(window).height();
  $("#map").width(totalWidth - $("#left-panel").width());
  $("#map").height(totalHeight - $("#header").height());
}

$(document).ready(function() {
  setMapSize();
  initMap();
});

$(window).resize(function() {
  setMapSize();
});

var map;
//Init google map
function initMap() {
  google.maps.visualRefresh = true;
  var mapOptions = {
    zoom: 7,
    mapTypeControlOptions: {mapTypeIds:
               [google.maps.MapTypeId.ROADMAP]}
  };

  var mapElement = document.getElementById('map');
  map = new google.maps.Map(mapElement, mapOptions);
  map.setMapTypeId(google.maps.MapTypeId.ROADMAP);

  //Load GeoJSON
  map.data.loadGeoJson("<%= Rails.application.routes.url_helpers.provinces_path format: :json %>");

  //Set center to garbon
  var gabon = new google.maps.LatLng(1.000000, 11.45000000);
  map.setCenter(gabon);

  //Create an info box for displaying names
  var infoBox = document.createElement('div');
  infoBox.innerHTML = "<div id='info-box'>Info</div>";
  map.controls[google.maps.ControlPosition.RIGHT_TOP].push(infoBox);

  map.data.addListener('mouseover', function(event) {
    map.data.revertStyle();
    $('#info-box').text(event.feature.getProperty('name'));
    map.data.overrideStyle(event.feature, { fillColor: 'red' });


  });

  map.data.addListener('mouseout', function(event){
    map.data.revertStyle();
  });

  map.data.setStyle(function(feature) {
    return { fillColor: 'green',
            strokeWeight: 1}
  });
}
